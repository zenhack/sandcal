<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<script src="/ui.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', function() {
				const app = Elm.Main.init()
				app.ports.syncFrame.subscribe(function() {
					window.parent.postMessage({
						setPath: location.pathname + location.hash,
					}, '*');
					window.parent.postMessage({
						setTitle: document.title,
					}, '*');
				});
				const getTitleRpcId = 0;
				window.addEventListener('message', function(event) {
					if(event.source !== window.parent) {
						return;
					}

					if(event.data.rpcId === getTitleRpcId) {
						app.ports.grainTitle.send(event.data.grainTitle);
					}
				})
				window.parent.postMessage({
					getGrainTitle: {},
					rpcId: getTitleRpcId,
					subscribe: true,
				}, '*')
			});
		</script>
	</head>
	<body>
		<noscript>SandCal requires JavaScript to function; please enable it.</noscript>
	</body>
</html>
